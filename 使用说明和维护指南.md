# 小红书MCP - 使用说明和维护指南

## 📖 快速开始

### 第一次使用

#### 1. 启动服务
```bash
# Windows
.\start-mcp.ps1

# Linux/macOS
./start-mcp.sh
```

#### 2. 登录小红书
服务启动后会自动打开浏览器，请按照提示完成登录：
1. 扫描二维码或输入账号密码
2. 完成安全验证
3. 等待登录成功提示

#### 3. 验证功能
```bash
# 检查服务状态
curl http://localhost:18060/health

# 测试MCP连接
curl -X POST http://localhost:18060/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list","params":{}}'
```

## 🛠️ 功能使用指南

### 1. 内容发布

#### 图文内容发布
```json
{
  "method": "mcp_xiaohongshu-mcp_publish_content",
  "params": {
    "title": "美食分享",
    "content": "今天做了一道超级好吃的菜！",
    "images": [
      "/path/to/image1.jpg",
      "/path/to/image2.jpg"
    ],
    "tags": ["美食", "生活", "分享"]
  }
}
```

**参数说明**：
- `title`: 标题（最多20个中文字符）
- `content`: 正文内容
- `images`: 图片路径列表（至少1张，最多9张）
- `tags`: 话题标签（可选）

#### 视频内容发布
```json
{
  "method": "mcp_xiaohongshu-mcp_publish_with_video",
  "params": {
    "title": "生活记录",
    "content": "记录美好的一天",
    "video": "/path/to/video.mp4",
    "tags": ["生活", "记录"]
  }
}
```

**注意事项**：
- 视频格式支持：MP4, MOV, AVI
- 视频大小限制：500MB以内
- 视频时长限制：60秒以内

### 2. 内容搜索

#### 搜索笔记
```json
{
  "method": "mcp_xiaohongshu-mcp_search_feeds",
  "params": {
    "keyword": "美食"
  }
}
```

**返回信息**：
- 笔记ID和标题
- 作者信息
- 互动数据（点赞、收藏、分享）
- 发布时间

### 3. 内容管理

#### 获取笔记详情
```json
{
  "method": "mcp_xiaohongshu-mcp_get_feed_detail",
  "params": {
    "feed_id": "笔记ID",
    "xsec_token": "访问令牌"
  }
}
```

#### 发表评论
```json
{
  "method": "mcp_xiaohongshu-mcp_post_comment_to_feed",
  "params": {
    "feed_id": "笔记ID",
    "xsec_token": "访问令牌",
    "content": "评论内容"
  }
}
```

### 4. 用户信息

#### 查看用户主页
```json
{
  "method": "mcp_xiaohongshu-mcp_user_profile",
  "params": {
    "user_id": "用户ID",
    "xsec_token": "访问令牌"
  }
}
```

#### 获取个人内容列表
```json
{
  "method": "mcp_xiaohongshu-mcp_list_feeds",
  "params": {}
}
```

## 🔧 在不同平台中使用

### Dify平台集成

#### 配置步骤
1. 打开Dify设置 → 模型供应商
2. 添加MCP服务器配置：
```json
{
  "xiaohongshu-mcp-server": {
    "transport": "sse",
    "url": "https://xiaohongshu-mcp-test.loca.lt/mcp",
    "timeout": 30,
    "headers": {
      "Content-Type": "application/json",
      "Accept": "application/json, text/event-stream"
    }
  }
}
```

#### 使用示例
在Dify工作流中添加工具节点：
1. 选择"小红书MCP"工具
2. 配置相应参数
3. 连接到其他节点

### Claude Desktop集成

#### 配置文件
编辑 `claude_desktop_config.json`：
```json
{
  "mcpServers": {
    "xiaohongshu-mcp": {
      "command": "go",
      "args": ["run", ".", "server"],
      "cwd": "/path/to/xiaohongshu-mcp"
    }
  }
}
```

#### 使用方法
1. 重启Claude Desktop
2. 在对话中直接使用小红书相关功能
3. 支持自然语言指令

### Trae IDE集成

#### 快速安装
```bash
# 运行安装脚本
.\quick-install.ps1
```

#### 手动配置
1. 打开Trae IDE设置
2. 添加MCP服务器配置
3. 重启IDE生效

## 📊 使用技巧和最佳实践

### 内容创作技巧

#### 1. 标题优化
- 控制在20字以内
- 包含关键词
- 使用表情符号增加吸引力
- 避免敏感词汇

#### 2. 内容结构
```
📍 地点/主题
💡 核心观点
📝 详细描述
🏷️ 相关标签
```

#### 3. 图片要求
- 分辨率：1080x1080以上
- 格式：JPG, PNG
- 大小：5MB以内
- 数量：1-9张

#### 4. 标签使用
- 每篇笔记3-5个标签
- 结合热门话题
- 包含品类标签
- 添加地理位置

### 发布时机优化

#### 最佳发布时间
- **工作日**: 12:00-14:00, 18:00-22:00
- **周末**: 10:00-12:00, 15:00-21:00
- **节假日**: 全天均可，避开深夜

#### 发布频率建议
- **个人账号**: 每天1-2篇
- **品牌账号**: 每天2-3篇
- **避免**: 短时间内大量发布

### 互动策略

#### 1. 评论管理
- 及时回复用户评论
- 使用友好的语气
- 引导用户互动

#### 2. 社区参与
- 主动评论他人内容
- 参与话题讨论
- 关注同领域创作者

## 🔍 故障排除

### 常见问题解决

#### 1. 登录失败
**症状**: 无法完成登录或登录状态丢失
**解决方案**:
```bash
# 清除登录缓存
rm -rf cookies/
# 重新启动服务
.\start-mcp.ps1 -Restart
```

#### 2. 发布失败
**症状**: 内容发布时出现错误
**检查项目**:
- [ ] 图片格式和大小
- [ ] 内容是否包含敏感词
- [ ] 网络连接是否正常
- [ ] 登录状态是否有效

#### 3. 图片上传失败
**症状**: 图片无法上传或显示
**解决方案**:
```bash
# 检查图片路径
ls -la /path/to/image.jpg
# 检查图片格式
file /path/to/image.jpg
# 压缩图片大小
# 使用图片处理工具调整
```

#### 4. 网络连接问题
**症状**: 无法访问小红书或连接超时
**解决方案**:
```bash
# 检查网络连接
ping xiaohongshu.com
# 设置代理（如需要）
$Env:http_proxy="http://127.0.0.1:7890"
$Env:https_proxy="http://127.0.0.1:7890"
```

### 错误代码说明

| 错误代码 | 说明 | 解决方案 |
|---------|------|----------|
| 401 | 未授权访问 | 重新登录 |
| 403 | 访问被禁止 | 检查账号状态 |
| 429 | 请求过于频繁 | 降低发布频率 |
| 500 | 服务器内部错误 | 稍后重试 |

## 🛡️ 日常维护

### 定期维护任务

#### 每日检查
- [ ] 服务运行状态
- [ ] 登录状态有效性
- [ ] 错误日志检查
- [ ] 磁盘空间检查

#### 每周维护
- [ ] 清理临时文件
- [ ] 更新依赖包
- [ ] 备份配置文件
- [ ] 性能监控检查

#### 每月维护
- [ ] 系统安全更新
- [ ] 日志文件归档
- [ ] 性能优化调整
- [ ] 功能测试验证

### 监控脚本

#### 服务状态监控
```bash
#!/bin/bash
# health-check.sh
while true; do
  if ! curl -f http://localhost:18060/health > /dev/null 2>&1; then
    echo "$(date): Service unhealthy, restarting..."
    ./start-mcp.ps1 -Restart
    sleep 30
  fi
  sleep 60
done
```

#### 日志监控
```bash
#!/bin/bash
# log-monitor.sh
tail -f logs/xiaohongshu-mcp.log | while read line; do
  if echo "$line" | grep -i "error\|fail\|exception"; then
    echo "$(date): Error detected: $line"
    # 发送告警通知
  fi
done
```

### 备份策略

#### 配置备份
```bash
# 备份配置文件
cp -r configs/ backups/configs-$(date +%Y%m%d)/
# 备份登录状态
cp -r cookies/ backups/cookies-$(date +%Y%m%d)/
```

#### 自动备份脚本
```bash
#!/bin/bash
# backup.sh
BACKUP_DIR="backups/$(date +%Y%m%d)"
mkdir -p "$BACKUP_DIR"

# 备份重要文件
cp -r configs/ "$BACKUP_DIR/"
cp -r cookies/ "$BACKUP_DIR/"
cp -r logs/ "$BACKUP_DIR/"

# 清理旧备份（保留7天）
find backups/ -type d -mtime +7 -exec rm -rf {} \;
```

### 性能优化

#### 资源监控
```bash
# 监控CPU和内存使用
top -p $(pgrep xiaohongshu-mcp)

# 监控网络连接
netstat -an | grep 18060

# 监控磁盘使用
df -h
du -sh logs/
```

#### 优化建议
1. **内存优化**: 定期重启服务释放内存
2. **磁盘优化**: 定期清理日志和临时文件
3. **网络优化**: 使用CDN加速图片上传
4. **并发优化**: 根据服务器性能调整并发数

## 📈 使用统计和分析

### 数据收集
- 发布成功率
- 平均响应时间
- 错误频率统计
- 用户活跃度

### 性能指标
- **可用性**: > 99.9%
- **响应时间**: < 3秒
- **错误率**: < 0.1%
- **并发处理**: 10个请求/秒

## 🆘 技术支持

### 获取帮助
1. **查看日志**: `logs/xiaohongshu-mcp.log`
2. **检查状态**: `curl http://localhost:18060/health`
3. **重启服务**: `.\start-mcp.ps1 -Restart`
4. **提交Issue**: GitHub Issues

### 联系方式
- **GitHub**: 项目Issues页面
- **文档**: 查看项目README
- **社区**: 相关技术论坛

---

## 📝 更新日志

### 版本历史
- **v1.0.0**: 基础功能发布
- **v1.1.0**: 添加Dify集成
- **v1.2.0**: 优化性能和稳定性
- **v1.3.0**: 增加监控和维护功能

### 即将推出
- [ ] 批量发布功能
- [ ] 内容模板系统
- [ ] 数据分析面板
- [ ] 移动端支持

---

*最后更新: 2024年12月*