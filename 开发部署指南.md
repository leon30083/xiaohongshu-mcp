# å°çº¢ä¹¦MCP - å¼€å‘éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### åŸºç¡€ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**: Windows 10/11, macOS, Linux
- **Goç‰ˆæœ¬**: 1.19+
- **Node.js**: 16.0+
- **æµè§ˆå™¨**: Chrome/Chromium
- **PowerShell**: 5.0+ (Windows)

### ç½‘ç»œè¦æ±‚
- èƒ½å¤Ÿè®¿é—®å°çº¢ä¹¦ç½‘ç«™
- å¦‚éœ€Difyé›†æˆï¼Œéœ€è¦å†…ç½‘ç©¿é€èƒ½åŠ›

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

#### Windows PowerShell
```powershell
# åŸºæœ¬å¯åŠ¨
.\start-mcp.ps1

# ç¼–è¯‘åå¯åŠ¨
.\start-mcp.ps1 -Build

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
.\start-mcp.ps1 -Check

# é‡å¯æœåŠ¡
.\start-mcp.ps1 -Restart

# åœæ­¢æœåŠ¡
.\start-mcp.ps1 -Stop
```

#### Linux/macOS
```bash
# æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
chmod +x start-mcp.sh

# å¯åŠ¨æœåŠ¡
./start-mcp.sh

# ç¼–è¯‘åå¯åŠ¨
./start-mcp.sh --build
```

#### Windows æ‰¹å¤„ç†
```cmd
# åŒå‡»è¿è¡Œæˆ–å‘½ä»¤è¡Œæ‰§è¡Œ
start-mcp.bat
```

### æ‰‹åŠ¨éƒ¨ç½²

#### 1. ç¯å¢ƒå‡†å¤‡
```bash
# æ£€æŸ¥Goç‰ˆæœ¬
go version

# å®‰è£…ä¾èµ–
go mod tidy

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | findstr 18060
```

#### 2. ç¼–è¯‘è¿è¡Œ
```bash
# å¼€å‘æ¨¡å¼
go run . server

# ç¼–è¯‘åè¿è¡Œ
go build -o xiaohongshu-mcp.exe .
.\xiaohongshu-mcp.exe server
```

#### 3. éªŒè¯éƒ¨ç½²
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:18060/health

# MCPç«¯ç‚¹æµ‹è¯•
curl -X POST http://localhost:18060/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"initialize","params":{}}'
```

## ğŸ”§ å¼€å‘ç¯å¢ƒé…ç½®

### IDEé›†æˆ

#### Trae IDE
```powershell
# ä¸€é”®å®‰è£…MCPé…ç½®
.\quick-install.ps1

# æˆ–å®Œæ•´å®‰è£…
.\install-trae-mcp.ps1
```

#### VS Code
```json
// .vscode/mcp.json
{
  "mcpServers": {
    "xiaohongshu-mcp": {
      "url": "http://localhost:18060/mcp",
      "description": "å°çº¢ä¹¦å†…å®¹å‘å¸ƒæœåŠ¡",
      "type": "http",
      "timeout": 30000
    }
  }
}
```

#### Claude Desktop
```json
// claude_desktop_config.json
{
  "mcpServers": {
    "xiaohongshu-mcp": {
      "command": "go",
      "args": ["run", ".", "server"],
      "cwd": "/path/to/xiaohongshu-mcp"
    }
  }
}
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# æµè§ˆå™¨è·¯å¾„ï¼ˆå¯é€‰ï¼‰
export BROWSER_PATH="/usr/bin/chromium"

# æ— å¤´æ¨¡å¼ï¼ˆå¯é€‰ï¼‰
export HEADLESS=true

# æœåŠ¡ç«¯å£ï¼ˆå¯é€‰ï¼‰
export PORT=18060

# æ—¥å¿—çº§åˆ«ï¼ˆå¯é€‰ï¼‰
export LOG_LEVEL=info
```

## ğŸŒ Difyé›†æˆéƒ¨ç½²

### æ¶æ„æ–¹æ¡ˆ

#### æ–¹æ¡ˆä¸€ï¼šæœ¬åœ°Dify + æœ¬åœ°MCPï¼ˆæ¨èå¼€å‘ï¼‰
```mermaid
graph LR
    A[æœ¬åœ°Dify] --> B[æœ¬åœ°MCP]
    B --> C[å°çº¢ä¹¦]
```

```bash
# 1. éƒ¨ç½²æœ¬åœ°Dify
git clone https://github.com/langgenius/dify.git
cd dify/docker
docker-compose up -d

# 2. å¯åŠ¨æœ¬åœ°MCP
.\start-mcp.ps1

# 3. é…ç½®Dify MCP
# URL: http://localhost:18060/mcp
```

#### æ–¹æ¡ˆäºŒï¼šäº‘ç«¯Dify + å†…ç½‘ç©¿é€ï¼ˆæ¨èç”Ÿäº§ï¼‰
```mermaid
graph LR
    A[äº‘ç«¯Dify] --> B[å†…ç½‘ç©¿é€]
    B --> C[æœ¬åœ°MCPä»£ç†]
    C --> D[æœ¬åœ°MCP]
```

```bash
# 1. å¯åŠ¨æœ¬åœ°MCP
.\start-mcp.ps1

# 2. å¯åŠ¨MCPä»£ç†æœåŠ¡å™¨
npm install
npm start

# 3. é…ç½®å†…ç½‘ç©¿é€
# é€‰æ‹©ä»¥ä¸‹ä»»ä¸€æ–¹æ¡ˆï¼š
```

### å†…ç½‘ç©¿é€æ–¹æ¡ˆ

#### LocalTunnelï¼ˆå½“å‰ä½¿ç”¨ï¼‰
```bash
# å®‰è£…
npm install -g localtunnel

# å¯åŠ¨éš§é“
lt --port 8080 --subdomain xiaohongshu-mcp-test

# è·å¾—URL: https://xiaohongshu-mcp-test.loca.lt
```

#### Ngrokï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰
```bash
# å®‰è£…ngrok
# å¯åŠ¨éš§é“
ngrok http 8080

# è·å¾—ä¸´æ—¶URL
```

### Dify MCPé…ç½®

#### æ¨èé…ç½®ï¼ˆSSEï¼‰
```json
{
  "xiaohongshu-mcp-server": {
    "transport": "sse",
    "url": "https://xiaohongshu-mcp-test.loca.lt/mcp",
    "timeout": 30,
    "headers": {
      "Content-Type": "application/json",
      "Accept": "application/json, text/event-stream"
    }
  }
}
```

#### å¤‡é€‰é…ç½®ï¼ˆHTTPï¼‰
```json
{
  "xiaohongshu-mcp-server": {
    "transport": "streamable_http",
    "url": "https://xiaohongshu-mcp-test.loca.lt/mcp"
  }
}
```

## ğŸ³ Dockeréƒ¨ç½²

### æ„å»ºé•œåƒ
```bash
# æ„å»ºDockeré•œåƒ
docker build -t xiaohongshu-mcp .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name xiaohongshu-mcp \
  -p 18060:18060 \
  -v $(pwd)/cookies:/app/cookies \
  xiaohongshu-mcp
```

### Docker Compose
```yaml
# docker-compose.yml
version: '3.8'
services:
  xiaohongshu-mcp:
    build: .
    ports:
      - "18060:18060"
    volumes:
      - ./cookies:/app/cookies
    environment:
      - HEADLESS=true
    restart: unless-stopped
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£å ç”¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | findstr 18060

# æ€æ­»å ç”¨è¿›ç¨‹
taskkill /F /PID <PID>
```

#### 2. Goæ¨¡å—ä¸‹è½½å¤±è´¥
```bash
# è®¾ç½®ä»£ç†
go env -w GOPROXY=https://goproxy.cn,direct

# æˆ–ä½¿ç”¨ç½‘ç»œä»£ç†
$Env:http_proxy="http://127.0.0.1:7890"
$Env:https_proxy="http://127.0.0.1:7890"
```

#### 3. æµè§ˆå™¨å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥Chromeè·¯å¾„
where chrome

# è®¾ç½®æµè§ˆå™¨è·¯å¾„
export BROWSER_PATH="/path/to/chrome"
```

#### 4. MCPè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:18060/health

# æ£€æŸ¥MCPç«¯ç‚¹
curl -X POST http://localhost:18060/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"initialize","params":{}}'
```

### æ—¥å¿—è°ƒè¯•
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export LOG_LEVEL=debug

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/xiaohongshu-mcp.log
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### èµ„æºé…ç½®
```bash
# è®¾ç½®Goè¿è¡Œæ—¶å‚æ•°
export GOMAXPROCS=4
export GOGC=100

# è®¾ç½®å†…å­˜é™åˆ¶
export GOMEMLIMIT=1GiB
```

### ç¼“å­˜ä¼˜åŒ–
- ç™»å½•çŠ¶æ€ç¼“å­˜ï¼š24å°æ—¶
- å›¾ç‰‡ä¸‹è½½ç¼“å­˜ï¼šæœ¬åœ°å­˜å‚¨
- APIå“åº”ç¼“å­˜ï¼š5åˆ†é’Ÿ

### å¹¶å‘æ§åˆ¶
- æœ€å¤§å¹¶å‘è¯·æ±‚ï¼š10
- è¯·æ±‚è¶…æ—¶ï¼š30ç§’
- é‡è¯•æ¬¡æ•°ï¼š3æ¬¡

## ğŸ” å®‰å…¨é…ç½®

### ç½‘ç»œå®‰å…¨
```bash
# å¯ç”¨HTTPSï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
export TLS_CERT_FILE="/path/to/cert.pem"
export TLS_KEY_FILE="/path/to/key.pem"

# è®¾ç½®è®¿é—®ç™½åå•
export ALLOWED_IPS="127.0.0.1,192.168.1.0/24"
```

### æ•°æ®å®‰å…¨
- Cookiesæœ¬åœ°åŠ å¯†å­˜å‚¨
- æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡é…ç½®
- å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶

## ğŸ“ˆ ç›‘æ§å‘Šè­¦

### å¥åº·æ£€æŸ¥
```bash
# å®šæœŸå¥åº·æ£€æŸ¥è„šæœ¬
#!/bin/bash
while true; do
  if ! curl -f http://localhost:18060/health; then
    echo "Service unhealthy, restarting..."
    ./start-mcp.ps1 -Restart
  fi
  sleep 60
done
```

### æ—¥å¿—ç›‘æ§
```bash
# ç›‘æ§é”™è¯¯æ—¥å¿—
tail -f logs/error.log | grep -i "error\|fail\|exception"
```

## ğŸš€ ç”Ÿäº§éƒ¨ç½²æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] ç³»ç»Ÿèµ„æºå……è¶³ï¼ˆCPU 2æ ¸+, å†…å­˜ 4GB+ï¼‰
- [ ] ç½‘ç»œè¿æ¥ç¨³å®š
- [ ] é˜²ç«å¢™ç«¯å£å¼€æ”¾ï¼ˆ18060, 8080ï¼‰
- [ ] SSLè¯ä¹¦é…ç½®ï¼ˆå¦‚éœ€HTTPSï¼‰
- [ ] ç›‘æ§å‘Šè­¦é…ç½®

### éƒ¨ç½²æ­¥éª¤
1. [ ] ç¯å¢ƒå‡†å¤‡å’Œä¾èµ–å®‰è£…
2. [ ] ä»£ç éƒ¨ç½²å’Œç¼–è¯‘
3. [ ] é…ç½®æ–‡ä»¶è®¾ç½®
4. [ ] æœåŠ¡å¯åŠ¨å’ŒéªŒè¯
5. [ ] å†…ç½‘ç©¿é€é…ç½®
6. [ ] Difyé›†æˆæµ‹è¯•
7. [ ] ç›‘æ§å‘Šè­¦é…ç½®
8. [ ] å¤‡ä»½æ¢å¤æµ‹è¯•

### éƒ¨ç½²åéªŒè¯
- [ ] æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] MCPå·¥å…·åˆ—è¡¨æ­£å¸¸
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] å‘å¸ƒåŠŸèƒ½æ­£å¸¸
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] Difyé›†æˆæ­£å¸¸

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. æ“ä½œç³»ç»Ÿç‰ˆæœ¬
2. Goç‰ˆæœ¬ä¿¡æ¯
3. é”™è¯¯æ—¥å¿—å†…å®¹
4. ç½‘ç»œç¯å¢ƒæè¿°
5. éƒ¨ç½²æ­¥éª¤è®°å½•

**è”ç³»æ–¹å¼**: è¯·åœ¨GitHub Issuesä¸­æäº¤é—®é¢˜